# 在局项目编码习惯和规范

## 一、项目概述

本文档基于对现有Objective-C项目的深入分析，总结了项目的编码习惯和规范，为未来Swift迁移提供参考依据。

## 二、命名规范

### 2.1 前缀命名
- **分类前缀**: 类名+功能描述 (如 `NSArray+safe`)

### 2.2 类命名规范
```objc
// 控制器命名
ViewController        // 基础控制器
ClientH5Controller   // 业务控制器
WKWebViewBaseController // 功能基类控制器

// 管理器命名
JSActionHandlerManager  // 管理器类
AuthenticationManager // 认证管理器
WebViewPerformanceManager // 性能管理器

// 模型命名
ClientSettingModel      // 业务模型
JsonModel            // 基础模型
AddressModel           // 功能模型
```

### 2.3 属性命名规范
```objc
// 布尔值属性以is开头
@property (assign, nonatomic) BOOL isWebViewLoading;
@property (assign, nonatomic) BOOL isTabbarShow;

// 块属性使用Block后缀
@property (copy, nonatomic) CallBackToNative callBackToNative;
@property (copy, nonatomic) WebViewJSCallbackBlock webviewBackCallBack;

// 视图属性
@property (strong, nonatomic) WKWebView *webView;
@property (strong, nonatomic) NavBar *navBar;
```

### 2.4 方法命名规范
```objc
// 初始化方法
+ (instancetype)sharedManager;
+ (instancetype)modelWithDict:(NSDictionary *)aDict;

// 事件处理方法
- (void)leftNavButtonAction:(UIButton*)sender;
- (void)networkNoteBtClick;

// JavaScript交互方法
- (void)jsCallObjc:(NSDictionary *)jsData completion:(void(^)(id result))completion;
- (void)objcCallJs:(NSDictionary *)dic;
```

## 三、代码组织结构

### 3.1 目录结构规范
```
Vientiane/
├── AppDelegate/           # 应用入口
├── Base/               # 基础框架
│   ├── BaseController/   # 基础控制器
│   ├── BaseView/         # 基础视图
│   ├── BaseModel/        # 基础模型
│   └── BaseManager/      # 基础管理器
├── ClientBase/           # 业务基础
│   ├── BaseController/   # 业务控制器
│   ├── JSBridge/         # JS桥接
│   └── BaseNet/          # 网络层
├── Module/               # 功能模块
├── Category/             # 分类扩展
├── Common/               # 公共组件
├── Tools/                # 工具类
└── ThirdParty/           # 第三方库
```

### 3.2 文件组织规范
```objc
// .h文件结构
#import <Foundation/Foundation.h>

NS_ASSUME_NONNULL_BEGIN

// 枚举定义
typedef NS_ENUM(NSUInteger, GDpushType) {
    GDpushTypeNormal = 0,
    GDpushTypePresent,
    GDpushTypeAlert
};

// 块定义
typedef void(^CallBackBlock)(id result);

// 协议定义
@protocol ProtocolName <NSObject>
@required
- (void)requiredMethod;
@optional
- (void)optionalMethod;
@end

// 类声明
@interface ClassName : SuperClass <Protocol>

// 属性声明
@property (nonatomic, strong) PropertyType *propertyName;

// 方法声明
- (void)methodName;

@end

NS_ASSUME_NONNULL_END
```

## 四、编码习惯

### 4.1 内存管理
```objc
// dealloc方法标准实现
- (void)dealloc {
    [[NSNotificationCenter defaultCenter] removeObserver:self];
    NSLog(@"在局%@ 生命周期dealloc",[NSString stringWithUTF8String:object_getClassName(self)]);
}

// 属性声明规范
@property (nonatomic, strong) NSObject *strongProperty;  // 强引用
@property (nonatomic, weak) id<Delegate> delegate;       // 委托用weak
@property (nonatomic, copy) NSString *stringProperty;    // 字符串用copy
@property (nonatomic, assign) BOOL boolProperty;         // 基本类型用assign
```

### 4.2 防御性编程
```objc
// 数组安全访问
- (id)safeObjectAtIndex:(NSUInteger)index {
    if (index >= self.count) {
        return nil;
    }
    return [self objectAtIndex:index];
}

// 参数检查
- (void)methodWithParameter:(id)parameter {
    if (!parameter) return;
    // 执行逻辑
}

// 空值处理
+ (instancetype)safeArrayWithObject:(id)object {
    if (object == nil) {
        return [self array];
    }
    return [self arrayWithObject:object];
}
```

### 4.3 单例模式
```objc
+ (instancetype)sharedManager {
    static ManagerClass *instance = nil;
    static dispatch_once_t onceToken;
    dispatch_once(&onceToken, ^{
        instance = [[ManagerClass alloc] init];
    });
    return instance;
}
```

### 4.4 日志规范
```objc
// 生命周期日志
NSLog(@"在局%@ 生命周期appear",[NSString stringWithUTF8String:object_getClassName(self)]);

// 调试日志格式
NSLog(@"在局Claude Code[功能描述]+具体信息");

// 内存警告日志
NSLog(@"在局%@ 内存警告",[NSString stringWithUTF8String:object_getClassName(self)]);
```

## 五、架构模式

### 5.1 MVC架构
- **Model**: 继承自`JsonModel`，使用JSONModel进行JSON解析
- **View**: 继承自`UIView`或自定义基类，处理UI展示
- **Controller**: 继承自`ViewController`或其子类，处理业务逻辑

### 5.2 管理器模式
```objc
// 统一的管理器接口
@interface Manager : NSObject
+ (instancetype)sharedManager;
- (void)setupManager;
- (void)cleanupManager;
@end

// 常见管理器
JSActionHandlerManager    // JS动作处理
AuthenticationManager   // 认证管理
ErrorCodeManager       // 错误码管理
WebViewPerformanceManager // 性能管理
```

### 5.3 委托模式
```objc
// 委托协议定义
@protocol Delegate <NSObject>
@optional
- (void)delegateMethodWithData:(id)data;
@end

// 委托属性声明
@property (nonatomic, weak) id<Delegate> delegate;

// 委托调用
if ([self.delegate respondsToSelector:@selector(delegateMethodWithData:)]) {
    [self.delegate delegateMethodWithData:data];
}
```

### 5.4 通知模式
```objc
// 通知定义（集中在CLNotificationDefine中）
extern NSString *const kNotificationName;

// 发送通知
[[NSNotificationCenter defaultCenter] postNotificationName:kNotificationName 
                                                    object:nil 
                                                  userInfo:@{@"key": value}];

// 监听通知
[[NSNotificationCenter defaultCenter] addObserver:self 
                                         selector:@selector(handleNotification:) 
                                             name:kNotificationName 
                                           object:nil];
```

## 六、JavaScript桥接规范

### 6.1 桥接架构
- 使用`WKWebViewJavascriptBridge`作为桥接基础
- 通过`JSActionHandlerManager`统一管理所有JS处理器
- 每个功能模块对应一个独立的Handler

### 6.2 处理器规范
```objc
// Handler基类
@interface JSActionHandler : NSObject
- (NSArray<NSString *> *)supportedActions;
- (void)handleAction:(NSString *)action 
              data:(id)data 
        controller:(UIViewController *)controller
          callback:(JSActionCallbackBlock)callback;
@end

// 功能Handler
JSNavigationHandler  // 导航相关
JSUIHandler         // UI相关
JSPaymentHandler    // 支付相关
JSShareHandler      // 分享相关
```

### 6.3 回调格式
```objc
// 统一的回调格式
@{
    @"apiType": @"actionName",
    @"success": @(YES/NO),
    @"data": responseData,
    @"errorMessage": @"错误信息"
}
```

## 七、网络请求规范

### 7.1 网络层架构
- 基于AFNetworking封装
- 使用单例模式管理网络请求
- 统一的请求和响应处理

### 7.2 请求封装
```objc
typedef void(^ClientCompletionBlock)(id aResponseObject, NSError* anError);

- (void)GET:(NSString *)URLString 
 parameters:(id)parameters 
      block:(ClientCompletionBlock)block;

- (void)POST:(NSString *)URLString 
  parameters:(id)parameters 
       block:(ClientCompletionBlock)block;
```

## 八、UI开发规范

### 8.1 视图创建
```objc
// 代码创建视图
- (void)setupUI {
    // 创建视图
    UIView *view = [[UIView alloc] init];
    
    // 添加到父视图
    [self.view addSubview:view];
    
    // 使用Masonry布局
    [view mas_makeConstraints:^(MASConstraintMaker *make) {
        make.edges.equalTo(self.view);
    }];
}
```

### 8.2 颜色管理
```objc
// 使用分类扩展管理颜色
[UIColor tyBgViewColor];    // 背景色
[UIColor color000000];      // 文字色
```

### 8.3 导航栏处理
```objc
// 隐藏系统导航栏
self.navigationController.navigationBarHidden = YES;

// 使用自定义导航栏
self.navBar = [[NavBar alloc] init];
[self.view addSubview:self.navBar];
```

## 九、第三方库使用规范

### 9.1 常用第三方库
- **AFNetworking**: 网络请求
- **Masonry**: 自动布局
- **SDWebImage**: 图片加载
- **MJRefresh**: 下拉刷新
- **JSONModel**: JSON解析
- **WKWebViewJavascriptBridge**: JS桥接

### 9.2 第三方SDK
- **微信SDK**: 登录、分享、支付
- **支付宝SDK**: 支付功能
- **友盟SDK**: 统计、推送
- **高德地图SDK**: 地图、定位
- **七牛SDK**: 文件上传

## 十、Swift迁移建议

### 10.1 命名转换
- 去除前缀，使用命名空间
- 属性名遵循Swift命名规范（小驼峰）
- 使用Swift原生类型替代NS类型

### 10.2 架构优化
- 使用协议替代继承
- 使用扩展组织代码
- 使用枚举关联值替代字典传参
- 使用Result类型处理异步回调

### 10.3 语言特性利用
- 使用可选类型替代nil检查
- 使用guard提前返回
- 使用defer管理资源释放
- 使用泛型提高代码复用

### 10.4 模块化建议
- 使用Swift Package Manager管理依赖
- 功能模块化，减少耦合
- 使用协议定义模块接口
- 单元测试覆盖核心功能

## 十一、注意事项

0. **升级重点**:包含所有功能，写法保持先进，符合代码规范，易维护和扩展
1. **保持一致性**: 新代码尽量遵循现有习惯，但不规范的地方不用强行一致，保持国际规范
2. **逐步迁移**: 优先迁移独立模块
3. **测试覆盖**: 迁移前后保证功能一致
4. **文档更新**: 及时更新相关文档
5. **版本兼容**: 注意iOS版本兼容性