# 真机iOS 18网络权限问题修复

## 修改时间
2025-08-01 23:23

## 问题分析

用户在真机iOS 18.5运行时遇到网络连接问题：
- 所有网络请求失败："似乎已断开与互联网的连接"
- 错误码 -1009，NSURLErrorDomain  
- Wi-Fi权限被拒绝

## 问题原因

iOS 14.5+引入了**本地网络隐私权限**，需要用户明确授权才能访问本地网络。

## 修复方案

### 1. Info.plist配置（已完成）
```xml
<!-- 本地网络权限描述 -->
<key>NSLocalNetworkUsageDescription</key>
<string>"在局"需要访问本地网络来发现附近的设备和提供更好的服务体验。</string>

<!-- Bonjour服务声明 -->
<key>NSBonjourServices</key>
<array>
    <string>_http._tcp</string>
    <string>_https._tcp</string>
</array>
```

### 2. 用户需要手动操作

#### 首次运行：
- 会弹出本地网络权限请求，选择**允许**

#### 如果之前拒绝了：
1. 打开 **设置**
2. 找到 **隐私与安全性**
3. 选择 **本地网络**
4. 找到 **在局**
5. 打开开关

#### 如果设置中没有"在局"：
1. 删除应用
2. 重新安装
3. 首次启动时允许权限

### 3. 验证权限状态
可以在设置中检查：
- 设置 > 在局 > 查看所有权限是否开启

## 注意事项

1. **必须重新编译安装**才能应用Info.plist的更改
2. 本地网络权限是iOS 14.5+的强制要求
3. 即使是HTTPS请求，也需要本地网络权限
4. 这个权限影响所有网络请求，包括API调用

## 测试要点

1. 删除应用后重新安装
2. 首次启动时注意权限弹窗
3. 确保允许本地网络权限
4. 验证网络请求是否正常