# 大量照片加载性能优化

## 问题描述
用户反馈点击相册后显示"正在处理..."，然后界面变成空白，无法显示照片。从日志发现用户的"最近项目"相册有18372张照片，导致加载卡死。

## 问题原因
1. `TZImageManager` 的 `getAssetsFromFetchResult` 方法同步枚举所有照片资源
2. 18000+张照片的处理导致内存压力和UI阻塞
3. 虽然在后台线程执行，但处理时间过长导致用户体验差

## 解决方案

### 1. 限制加载数量
对于超大相册（超过5000张），只加载前5000张照片：

```objc
NSUInteger maxPhotosToLoad = 5000;
if (totalCount > maxPhotosToLoad) {
    // 只加载部分照片
    for (NSUInteger i = 0; i < maxPhotosToLoad && i < totalCount; i++) {
        PHAsset *asset = [self->_model.result objectAtIndex:i];
        TZAssetModel *model = [TZAssetModel modelWithAsset:asset type:[[TZImageManager manager] getAssetType:asset]];
        [limitedModels addObject:model];
    }
}
```

### 2. 添加进度日志
在 `TZImageManager.getAssetsFromFetchResult` 中添加进度日志：

```objc
if (processedCount % 1000 == 0) {
    NSLog(@"处理进度: %lu/%lu", processedCount, totalCount);
}
```

### 3. 增强错误处理
- 检查返回的models是否为nil
- 添加更详细的日志记录
- 确保在各种情况下都能正确显示UI

## 性能优化建议

### 1. 懒加载模式
考虑实现分页加载，而不是一次性加载所有照片：
- 初始只加载可见范围的照片
- 滚动时动态加载更多

### 2. 缓存优化
- 对已处理的TZAssetModel进行缓存
- 避免重复创建相同的模型对象

### 3. 内存管理
- 使用@autoreleasepool包装大量对象创建
- 及时释放不需要的资源

## 用户体验优化

### 1. 显示加载进度
- 显示当前加载进度百分比
- 提供取消按钮

### 2. 分组显示
- 按日期或月份分组显示照片
- 减少一次性显示的数量

### 3. 提示信息
当检测到超大相册时，提示用户：
- "您的相册包含大量照片，正在优化加载..."
- "为了更好的体验，建议使用相册分类查看"

## 测试建议
1. 测试不同数量级的相册（100、1000、10000、20000+）
2. 测试不同设备的内存处理能力
3. 测试滚动性能和内存占用