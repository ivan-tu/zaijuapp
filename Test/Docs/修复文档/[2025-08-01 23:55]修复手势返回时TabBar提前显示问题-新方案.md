# 修复手势返回时TabBar提前显示问题 - 新方案

## 问题描述
当用户从内页（hidesBottomBarWhenPushed=YES）通过手势返回到Tab根页面（hidesBottomBarWhenPushed=NO）时，TabBar会在手势刚开始就立即显示在内页上层，导致视觉效果异常。

## 问题原因
iOS系统的默认行为是在`popViewControllerAnimated:`被调用时立即更新TabBar的显示状态，而不会等待转场动画完成。这导致TabBar在转场动画还未开始就已经显示。

## 解决方案
完全接管TabBar的显示隐藏控制，不依赖系统的自动处理。

### 1. Push时手动隐藏TabBar
在`pushViewController:animated:`方法中，如果目标页面需要隐藏TabBar，提前手动隐藏：

```objc
- (void)pushViewController:(UIViewController *)viewController animated:(BOOL)animated {
    
    // 在push前禁用交互式手势，防止冲突
    self.interactivePopGestureRecognizer.enabled = NO;
    
    // 🔧 关键修复：如果新页面需要隐藏TabBar，在push前就手动隐藏
    if (viewController.hidesBottomBarWhenPushed && self.tabBarController) {
        NSLog(@"在局Claude Code[TabBar修复]+Push前手动隐藏TabBar");
        self.tabBarController.tabBar.hidden = YES;
    }
    
    [super pushViewController:viewController animated:animated];
}
```

### 2. 导航完成后根据当前页面设置TabBar状态
在`navigationController:didShowViewController:animated:`方法中，根据当前显示的视图控制器设置TabBar的显示状态：

```objc
// 🔧 关键修复：在导航完成后手动控制TabBar显示状态
if (self.tabBarController) {
    if (viewController.hidesBottomBarWhenPushed) {
        // 当前页面需要隐藏TabBar
        self.tabBarController.tabBar.hidden = YES;
        NSLog(@"在局Claude Code[TabBar修复]+导航完成，当前页面隐藏TabBar");
    } else {
        // 当前页面需要显示TabBar
        self.tabBarController.tabBar.hidden = NO;
        NSLog(@"在局Claude Code[TabBar修复]+导航完成，当前页面显示TabBar");
    }
}
```

## 修改位置
- 文件：`XZVientiane/XZBase/BaseController/XZNavigationController.m`
- 方法：
  - `pushViewController:animated:` - Push时隐藏TabBar
  - `navigationController:didShowViewController:animated:` - 导航完成后设置TabBar状态

## 效果
- Push进入内页时，TabBar会在动画开始前就隐藏，避免闪烁
- Pop返回时，TabBar会在导航完成后才显示，避免提前出现在内页上层
- 手势返回过程中，TabBar始终保持隐藏状态，直到完全返回到Tab根页面才显示

## 优势
1. 逻辑简单清晰，易于维护
2. 不影响iOS系统的其他机制
3. 避免了复杂的视图层级操作
4. 解决了TabBar提前显示的问题