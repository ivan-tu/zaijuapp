# 修复手势返回TabBar显示问题 - Frame方案

## 问题描述
在手势返回时，即使设置了`tabBar.hidden = YES`，iOS系统仍会在交互式转场开始时自动显示TabBar，导致TabBar提前出现在内页上层。

## 问题根因
iOS系统在交互式转场时会强制根据目标视图控制器的`hidesBottomBarWhenPushed`属性来管理TabBar的显示状态，会覆盖我们对`hidden`属性的设置。

## 解决方案
通过调整TabBar的frame位置来控制其可见性，而不是使用hidden属性。

### 1. Push时将TabBar移出屏幕
```objc
// 🔧 关键修复：如果新页面需要隐藏TabBar，在push前将其移出屏幕
if (viewController.hidesBottomBarWhenPushed && self.tabBarController) {
    UITabBar *tabBar = self.tabBarController.tabBar;
    CGRect tabBarFrame = tabBar.frame;
    tabBarFrame.origin.y = [UIScreen mainScreen].bounds.size.height;
    tabBar.frame = tabBarFrame;
    NSLog(@"在局Claude Code[TabBar修复]+Push前将TabBar移出屏幕");
}
```

### 2. 手势开始时确保TabBar在屏幕外
```objc
// 如果是从隐藏TabBar的页面返回到显示TabBar的页面，临时移动TabBar
if (currentVC.hidesBottomBarWhenPushed && toVC && !toVC.hidesBottomBarWhenPushed && self.tabBarController) {
    UITabBar *tabBar = self.tabBarController.tabBar;
    CGRect tabBarFrame = tabBar.frame;
    // 将TabBar移出屏幕底部
    tabBarFrame.origin.y = [UIScreen mainScreen].bounds.size.height;
    tabBar.frame = tabBarFrame;
    NSLog(@"在局Claude Code[TabBar修复]+手势开始，将TabBar移出屏幕");
}
```

### 3. 导航完成后根据需要恢复TabBar位置
```objc
if (currentVC.hidesBottomBarWhenPushed) {
    // 当前页面需要隐藏TabBar - 移出屏幕
    CGRect tabBarFrame = tabBar.frame;
    tabBarFrame.origin.y = screenHeight;
    tabBar.frame = tabBarFrame;
} else {
    // 当前页面需要显示TabBar - 恢复到正确位置
    CGRect tabBarFrame = tabBar.frame;
    tabBarFrame.origin.y = screenHeight - tabBarHeight;
    // 使用动画平滑过渡
    [UIView animateWithDuration:0.25 animations:^{
        tabBar.frame = tabBarFrame;
    }];
}
```

### 4. 手势取消时恢复正确位置
```objc
dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(0.3 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{
    UIViewController *currentVC = self.topViewController;
    if (currentVC && self.tabBarController) {
        UITabBar *tabBar = self.tabBarController.tabBar;
        CGFloat screenHeight = [UIScreen mainScreen].bounds.size.height;
        CGFloat tabBarHeight = tabBar.frame.size.height;
        CGRect tabBarFrame = tabBar.frame;
        
        if (currentVC.hidesBottomBarWhenPushed) {
            // 当前页面需要隐藏TabBar - 确保在屏幕外
            tabBarFrame.origin.y = screenHeight;
            tabBar.frame = tabBarFrame;
        } else {
            // 当前页面需要显示TabBar - 恢复到正确位置
            tabBarFrame.origin.y = screenHeight - tabBarHeight;
            tabBar.frame = tabBarFrame;
        }
    }
});
```

## 修改文件
- `XZVientiane/XZBase/BaseController/XZNavigationController.m`

## 优势
1. 避免了iOS系统对hidden属性的覆盖
2. 通过物理位置控制TabBar的可见性，更加可靠
3. 使用动画过渡，视觉效果更自然
4. 不影响系统的其他机制

## 注意事项
1. 需要正确计算屏幕高度和TabBar高度
2. 在适当的时机使用动画，避免突兀的显示效果
3. 手势取消时需要延迟处理，确保转场动画完成