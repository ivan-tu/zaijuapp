# Share弹窗实现分析

## 问题描述
用户反馈点击share后原生没有收到任何消息，显示的是h5的弹窗。

## 分析过程

### 1. Share功能调用链路

#### JavaScript端调用流程：
1. H5页面的`newShare.js`组件中，当用户点击分享按钮时会调用`callAppShare`方法
2. `callAppShare`使用`wx.app.call('share', {...})`调用原生
3. `wx.app.call`实际上是通过`webViewBridge.callHandler('xzBridge', {action:'share', data:...})`发送到原生

#### 原生端接收流程：
1. `XZWKWebViewBaseController`注册了`xzBridge`处理器
2. `xzBridge`处理器调用`jsCallObjc`方法
3. `CFJClientH5Controller`重写了`jsCallObjc`方法，会检查`JSActionHandlerManager`是否能处理
4. `JSActionHandlerManager`已注册`JSShareHandler`来处理"share"动作
5. `JSShareHandler`会调用`CFJClientH5Controller`的`shareContent`方法

### 2. 代码架构

#### 关键文件：
- `/XZVientiane/manifest/static/components/common/newShare/newShare.js` - H5分享组件
- `/XZVientiane/manifest/static/app/webviewbridge.js` - JS桥接定义
- `/XZVientiane/ClientBase/JSBridge/Handlers/JSShareHandler.m` - 分享处理器
- `/XZVientiane/ClientBase/BaseController/CFJClientH5Controller.m` - 分享实现

### 3. 调试方案

已在关键位置添加调试日志：

1. **jsCallObjc方法** (CFJClientH5Controller.m:3353)
   ```objc
   NSLog(@"在局Claude Code[Share测试]+jsCallObjc收到action: %@, data: %@", action, jsData);
   ```

2. **JSShareHandler** (JSShareHandler.m:37)
   ```objc
   NSLog(@"在局Claude Code[Share测试]+JSShareHandler收到share请求，data: %@", data);
   ```

3. **shareContent方法** (CFJClientH5Controller.m:1858)
   ```objc
   NSLog(@"在局Claude Code[Share测试]+shareContent被调用，dic: %@", dic);
   ```

### 4. 可能的问题原因

1. **JS桥接未正确初始化**：检查`wx.app.connect`是否被调用
2. **H5页面判断错误**：可能H5页面判断当前环境不是app，没有调用原生分享
3. **分享数据格式问题**：检查传递的数据格式是否正确

### 5. 建议排查步骤

1. 运行应用，点击分享按钮
2. 查看Xcode控制台日志，看是否有上述调试日志输出
3. 如果没有日志输出，说明JS没有正确调用原生
4. 如果有日志输出，根据日志内容判断具体问题

### 6. 修复后清理

测试完成后，请删除添加的调试日志：
- JSShareHandler.m 第37行
- CFJClientH5Controller.m 第1858行  
- CFJClientH5Controller.m 第3353行