# 修复地区选择器只显示省市不显示区的问题

## 问题描述

在局Claude Code[地区选择功能修复]：用户反馈地区选择器只能选择省市两级，不能选择到区县级别。

## 问题原因

经过代码分析发现：

1. 项目中有两个地址选择器实现：
   - `MOFSAddressPickerView` - 已经支持三级选择（省市区）
   - `CFJAdressPickerView` - 原本只支持二级选择（省市）

2. 实际使用中，应用调用的是 `CFJAdressPickerView`（在 JSUIHandler.m 的 handleAreaSelect 和 handleAreaSecondarySelect 方法中）

3. 虽然数据文件 city.json 包含完整的三级地址数据，数据模型也正确解析了三级结构，但 `CFJAdressPickerView` 的实现中只显示了两个组件。

## 修复方案

### 1. 修改 CFJAdressPickerView.m

**主要修改内容：**

1. 添加区级选择的状态属性：
```objc
@property (nonatomic, assign) NSInteger selectedIndex_district;
```

2. 修改组件数量从2个改为3个：
```objc
- (NSInteger)numberOfComponentsInPickerView:(UIPickerView *)pickerView {
    return 3;  // 原来是 2
}
```

3. 更新选择逻辑，当选择省或市时，重置并刷新后续组件：
```objc
case 0:  // 选择省
    self.selectedIndex_province = row;
    self.selectedIndex_city = 0;
    self.selectedIndex_district = 0;
    [self reloadComponent:1];
    [self reloadComponent:2];
    break;
case 1:  // 选择市
    self.selectedIndex_city = row;
    self.selectedIndex_district = 0;
    [self reloadComponent:2];
    break;
case 2:  // 选择区
    self.selectedIndex_district = row;
    break;
```

4. 更新提交逻辑，返回完整的省-市-区地址：
```objc
if (!districtModel) {
    address = [NSString stringWithFormat:@"%@-%@",addressModel.name,cityModel.name];
    zipcode = [NSString stringWithFormat:@"%@-%@",addressModel.zipcode,cityModel.zipcode];
} else {
    address = [NSString stringWithFormat:@"%@-%@-%@",addressModel.name,cityModel.name,districtModel.name];
    zipcode = [NSString stringWithFormat:@"%@-%@-%@",addressModel.zipcode,cityModel.zipcode,districtModel.zipcode];
}
```

### 2. 修改 MOFSPickerManager.m

更新默认值以支持三级选择：
```objc
// showCFJAddressPickerWithDefaultZipcode 方法中
if (zipcode == nil || [zipcode isEqual: @""]) {
    zipcode = @"2-2-3";  // 原来是 "2-2"
}
```

## 影响范围

1. 所有使用地区选择功能的地方现在都会显示三级选择（省市区）
2. 返回的地址格式从"省-市"变为"省-市-区"
3. JSUIHandler.m 中的处理逻辑仍然兼容，因为它提取城市名称的逻辑（components[1]）不受影响

## 测试建议

1. 测试地区选择器是否正确显示三级选择
2. 测试选择省份后，市和区是否正确刷新
3. 测试选择市后，区是否正确刷新
4. 测试提交后返回的地址格式是否正确（省-市-区）
5. 测试原有的业务逻辑是否正常工作

## 文件修改清单

- `/XZVientiane/Module/MOFSPickerManager/CFJAdressPickerView.m`
- `/XZVientiane/Module/MOFSPickerManager/MOFSPickerManager.m`