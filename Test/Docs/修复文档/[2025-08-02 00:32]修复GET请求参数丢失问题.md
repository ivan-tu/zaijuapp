# 修复GET请求参数丢失问题

## 修改时间
2025-08-02 00:32

## 问题描述
后端日志显示收到的GET请求参数为空数组，虽然客户端日志显示参数已经传递，但实际HTTP请求的URL中没有包含查询字符串。

示例：
```
在局Claude Code[网络请求]+GET请求: /activityapi/getActivityDetail, 参数: {
    id = 687849a94650fa6c2b544141;
}
在局Claude Code[网络请求]+发送GET请求到父类, 完整URL: https://zaiju.com/activityapi/getActivityDetail
```

URL缺少了 `?id=687849a94650fa6c2b544141`

## 问题分析
AFNetworking的`GET:parameters:headers:progress:success:failure:`方法应该自动将参数转换为查询字符串，但在这个项目中没有正常工作。可能的原因：
1. AFNetworking版本问题
2. 自定义的网络管理器配置问题
3. 参数序列化器配置问题

## 修复方案
在`ClientJsonRequestManager.m`中手动构建带参数的GET请求URL：

```objc
// 在局Claude Code修复：手动构建带参数的URL
NSString *finalURLString = URLString;
if (parameters && [parameters isKindOfClass:[NSDictionary class]] && [(NSDictionary *)parameters count] > 0) {
    NSError *error;
    NSURLRequest *request = [[AFHTTPRequestSerializer serializer] requestWithMethod:@"GET" 
                                                                          URLString:[[NSURL URLWithString:URLString relativeToURL:self.baseURL] absoluteString]
                                                                         parameters:parameters 
                                                                              error:&error];
    if (!error && request.URL) {
        // 从完整URL中提取相对路径和查询字符串
        NSString *fullURL = request.URL.absoluteString;
        NSString *baseURLString = self.baseURL.absoluteString;
        if ([fullURL hasPrefix:baseURLString]) {
            finalURLString = [fullURL substringFromIndex:baseURLString.length];
        }
        NSLog(@"在局Claude Code[网络请求]+构建的GET请求URL: %@", finalURLString);
    }
}

// 使用构建好的URL发送请求，参数设为nil避免重复
[super GET:finalURLString parameters:nil headers:headers progress:nil success:^{...}];
```

## 修改的文件
- `XZVientiane/ClientBase/BaseNet/ClientJsonRequestManager.m`

## 测试要点
1. 重新编译运行
2. 进入活动详情页
3. 检查日志中的URL是否包含查询参数
4. 确认内页数据能正常显示
5. 验证后端是否收到了正确的参数

## 预期结果
- GET请求的URL应该包含查询字符串，如：`/activityapi/getActivityDetail?id=687849a94650fa6c2b544141`
- 后端应该能正确接收到参数
- 内页数据应该正常显示