# 修复内页数据显示问题

## 修改时间
2025-08-01 22:05

## 问题分析

### 1. 网络已恢复正常
- 重启手机解决了iOS 18的网络权限缓存bug
- 首页下拉刷新后数据正常显示
- 内页评论列表正常显示
- 说明网络连接已经正常

### 2. 内页关键数据不显示的原因
通过日志对比发现参数名错误：
- **失败的请求**：`getActivityDetail`使用参数`id`
- **成功的请求**：`getActivityUser`使用参数`activityid`

服务器API期望的参数名是`activityid`，而不是`id`。

## 修复方案

### 在Native层做参数转换
在`JSNetworkHandler.m`中添加了参数名转换逻辑：

```objc
// 修复参数名问题：将id转换为activityid
if ([url containsString:@"getActivityDetail"]) {
    if (parameters[@"id"] && !parameters[@"activityid"]) {
        NSMutableDictionary *fixedParameters = [parameters mutableCopy];
        fixedParameters[@"activityid"] = parameters[@"id"];
        [fixedParameters removeObjectForKey:@"id"];
        parameters = fixedParameters;
    }
}
```

## 测试要点

1. 重新编译运行
2. 进入任意活动详情页
3. 检查内页数据是否正常显示
4. 查看日志确认参数转换是否生效

## 注意事项

1. 这是一个临时修复方案
2. 根本原因是前端JS代码使用了错误的参数名
3. 长期来看应该修复JS代码
4. 但由于manifest目录通常不修改，所以在Native层做了兼容处理

## 其他发现

1. Token刷新仍然失败（"empty appid or appsecret"）
2. 但不影响数据请求（可能服务器允许无Token访问）
3. 基础网络测试中apple.com仍无法访问（但不影响业务）