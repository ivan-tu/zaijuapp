# 修复手势返回时TabBar提前显示问题

## 问题描述
当用户从内页（hidesBottomBarWhenPushed=YES）通过手势返回到Tab根页面（hidesBottomBarWhenPushed=NO）时，TabBar会在手势刚开始就立即显示在内页上层，导致视觉效果异常。

## 问题原因
iOS系统的默认行为是在`popViewControllerAnimated:`被调用时立即更新TabBar的显示状态，而不会等待转场动画完成。这导致TabBar在转场动画还未开始就已经显示。

## 解决方案
使用遮罩视图覆盖TabBar，避免其提前显示。

### 1. 在转场动画开始时创建遮罩视图
在`animateDismissalWithContext:`方法中，当检测到是返回到Tab根页面时，创建一个遮罩视图：

```objc
if (isReturningToTabRoot) {
    NSLog(@"在局Claude Code[转场修复]+检测到返回Tab根页面，特殊处理避免TabBar错位");
    
    // 🔧 关键修复：为了避免TabBar提前显示，我们需要临时创建一个遮罩视图
    // 创建一个和fromVC.view相同的遮罩视图，覆盖在TabBar上方
    UIView *tabBarMaskView = [[UIView alloc] initWithFrame:containerView.bounds];
    tabBarMaskView.backgroundColor = containerView.backgroundColor ?: [UIColor whiteColor];
    tabBarMaskView.tag = 99999; // 特殊标记便于后续移除
    
    // 将遮罩视图插入到containerView中，位于fromVC.view下方
    [containerView insertSubview:tabBarMaskView atIndex:0];
    
    // 对于Tab根页面，不要将其view添加到containerView
    toVC.view.hidden = NO;
    toVC.view.alpha = 1.0;
}
```

### 2. 转场完成后移除遮罩视图
在转场动画完成时，移除遮罩视图：

```objc
// 🔧 关键修复：移除TabBar遮罩视图
UIView *tabBarMaskView = [containerView viewWithTag:99999];
if (tabBarMaskView) {
    [tabBarMaskView removeFromSuperview];
    NSLog(@"在局Claude Code[转场修复]+移除TabBar遮罩视图");
}
```

### 3. 处理转场取消的情况
如果用户取消手势返回，也需要移除遮罩视图：

```objc
if (isReturningToTabRoot) {
    // Tab根页面保持原样
    toVC.view.alpha = 1.0;
    
    // 🔧 关键修复：转场取消时也要移除TabBar遮罩视图
    UIView *tabBarMaskView = [containerView viewWithTag:99999];
    if (tabBarMaskView) {
        [tabBarMaskView removeFromSuperview];
        NSLog(@"在局Claude Code[转场修复]+转场取消，移除TabBar遮罩视图");
    }
}
```

## 修改位置
- 文件：`XZVientiane/XZBase/BaseController/XZNavigationController.m`
- 方法：`animateDismissalWithContext:` - 处理返回动画和遮罩视图

## 效果
修复后，手势返回时TabBar会被遮罩视图覆盖，不会提前显示在内页上层。转场动画完成后，遮罩视图会被移除，TabBar正常显示，提供了更流畅的用户体验。