# iOS 18网络访问域名限制问题

## 修改时间
2025-08-01 21:50

## 问题发现
1. 用户发现基础网络测试中：
   - apple.com 访问失败
   - zaiju.com 访问成功
2. 所有第三方服务（友盟、高德地图等）都无法访问
3. Wi-Fi信息请求持续报错

## 根本原因
Info.plist中`NSAllowsArbitraryLoads`设置为`false`，导致只有在`NSExceptionDomains`中明确列出的域名才能访问。

## 已实施的修改

### 1. 开启任意域名访问
```xml
<key>NSAllowsArbitraryLoads</key>
<true/>
```
将false改为true，允许访问所有域名。

### 2. 添加Wi-Fi持久连接
```xml
<key>UIRequiresPersistentWiFi</key>
<true/>
```
解决"nehelper sent invalid result code"错误。

## 影响分析

### 之前的限制
- 只能访问：localhost、statics.tuiya.cc、zaiju.com、amap.com
- 无法访问：友盟统计、苹果服务器、其他第三方服务

### 修改后
- 可以访问所有HTTPS域名
- 解决了第三方SDK无法工作的问题
- 修复了网络状态检测失败的问题

## 安全建议
虽然开启了`NSAllowsArbitraryLoads`，但建议：
1. 所有API使用HTTPS
2. 实施证书固定（Certificate Pinning）
3. 上架前考虑将重要域名加入例外列表并关闭任意访问

## 测试要点
1. 重新编译运行
2. 检查所有网络请求是否正常
3. 验证第三方SDK是否正常工作
4. 确认Wi-Fi错误是否消失

## 注意事项
- 这个修改需要重新编译才能生效
- App Store审核可能会询问为什么需要任意网络访问
- 建议在正式版本中精确配置需要访问的域名