# [2025-08-02 22:50]ä¿®å¤æ‰‹åŠ¿è¿”å›JavaScriptæ‰§è¡Œæƒé™é—®é¢˜

## ğŸ¯ é—®é¢˜åˆ†æ

ä»æ—¥å¿—ä¸­å‘ç°ï¼Œè™½ç„¶JavaScriptç¯å¢ƒæ£€æŸ¥æ˜¾ç¤ºç¨³å®šï¼ˆ`js_env_stable`ï¼‰ï¼Œä½†é¡µé¢æ¢å¤ç­–ç•¥æ‰§è¡Œæ—¶ä»ç„¶æŠ¥é”™ï¼š
```
åœ¨å±€Claude Code[é¡µé¢æ¢å¤ç­–ç•¥]+é¡µé¢çŠ¶æ€æ£€æŸ¥å¤±è´¥: å‘ç”Ÿäº†JavaScriptå¼‚å¸¸
åœ¨å±€Claude Code[é¡µé¢æ¢å¤ç­–ç•¥]+ç­–ç•¥0æ‰§è¡Œç»“æœ: content_made_visible_1_containers
åœ¨å±€Claude Code[é¡µé¢æ¢å¤ç­–ç•¥]+ç­–ç•¥1æ‰§è¡Œç»“æœ: reloadOtherPages_called
```

è¿™è¯´æ˜é—®é¢˜ä¸æ˜¯JavaScriptç¯å¢ƒæœ¬èº«ï¼Œè€Œæ˜¯ `safelyEvaluateJavaScript` æ–¹æ³•çš„æƒé™æ£€æŸ¥å¤ªä¸¥æ ¼ã€‚

## ğŸ” æ ¹æœ¬åŸå› 

åœ¨ `XZWKWebViewBaseController.m` ä¸­ï¼Œ`safelyEvaluateJavaScript:completionHandler:` æ–¹æ³•æœ‰ä¸¥æ ¼çš„æ‰§è¡Œæ¡ä»¶æ£€æŸ¥ï¼š

```objc
// åˆ¤æ–­æ˜¯å¦å…è®¸æ‰§è¡Œ
BOOL shouldExecute = isAppActive || isNetworkRecoveryScenario || isEssentialScript || 
                    (isInteractiveRestore && isControllerActive);
```

é¡µé¢æ¢å¤ç­–ç•¥ä¸­çš„JavaScriptä»£ç æ²¡æœ‰è¢«è¯†åˆ«ä¸º `isInteractiveRestore`ï¼Œå¯¼è‡´æ‰§è¡Œè¢«æ‹’ç»ã€‚

## âœ… ä¿®å¤æ–¹æ¡ˆ

### ä¿®æ”¹æ–‡ä»¶
`XZWKWebViewBaseController.m` ç¬¬2532-2539è¡Œ

### æ‰©å±• isInteractiveRestore çš„è¯†åˆ«èŒƒå›´
```objc
BOOL isInteractiveRestore = [javaScriptString containsString:@"document.body.style.display"] ||
                           [javaScriptString containsString:@"window.dispatchEvent"] ||
                           [javaScriptString containsString:@"reloadOtherPages"] ||
                           [javaScriptString containsString:@"getCurrentPages"] ||
                           [javaScriptString containsString:@"window.scrollTo"] ||
                           [javaScriptString containsString:@"visibilitychange"] ||
                           [javaScriptString containsString:@"document.readyState"] ||
                           [javaScriptString containsString:@"mainElementsCount"];
```

### æ–°å¢è¯†åˆ«çš„å…³é”®å­—
1. `reloadOtherPages` - é¡µé¢é‡è½½æ–¹æ³•
2. `getCurrentPages` - è·å–å½“å‰é¡µé¢æ–¹æ³•
3. `window.scrollTo` - æ»šåŠ¨æ¨¡æ‹Ÿ
4. `visibilitychange` - é¡µé¢å¯è§æ€§äº‹ä»¶
5. `document.readyState` - é¡µé¢çŠ¶æ€æ£€æŸ¥
6. `mainElementsCount` - é¡µé¢å…ƒç´ ç»Ÿè®¡

## ğŸ“Š ä¿®å¤æ•ˆæœ

### ä¿®å¤å‰
- é¡µé¢æ¢å¤ç­–ç•¥çš„JavaScriptæ‰§è¡Œè¢«æ‹’ç»
- æ—¥å¿—æ˜¾ç¤º"å‘ç”Ÿäº†JavaScriptå¼‚å¸¸"
- æ‰‹åŠ¿è¿”å›åé¡µé¢ç©ºç™½

### ä¿®å¤åé¢„æœŸ
- é¡µé¢æ¢å¤ç­–ç•¥å¯ä»¥æ­£å¸¸æ‰§è¡Œ
- ä¸å†å‡ºç°JavaScriptå¼‚å¸¸
- æ‰‹åŠ¿è¿”å›åé¡µé¢æ­£å¸¸æ˜¾ç¤º

## ğŸš€ æŠ€æœ¯ä¼˜åŠ¿

1. **ç²¾å‡†è¯†åˆ«**ï¼šåªæ”¾è¡Œé¡µé¢æ¢å¤ç›¸å…³çš„JavaScript
2. **å®‰å…¨å¯æ§**ï¼šä¸å½±å“å…¶ä»–å®‰å…¨æ£€æŸ¥
3. **å‘åå…¼å®¹**ï¼šä¸å½±å“ç°æœ‰åŠŸèƒ½

## âš ï¸ é‡è¦æç¤º

è¿™ä¸ªä¿®å¤é…åˆä¹‹å‰çš„1.2ç§’å»¶è¿Ÿå’ŒJavaScriptç¯å¢ƒæ£€æŸ¥ï¼Œå½¢æˆäº†å®Œæ•´çš„ä¿®å¤æ–¹æ¡ˆï¼š

1. **å»¶è¿Ÿ1.2ç§’** - ç­‰å¾…ç¯å¢ƒç¨³å®š
2. **ç¯å¢ƒæ£€æŸ¥** - ç¡®ä¿JavaScriptå¯æ‰§è¡Œ
3. **æƒé™æ”¾è¡Œ** - å…è®¸é¡µé¢æ¢å¤è„šæœ¬æ‰§è¡Œ

è¯·é‡æ–°ç¼–è¯‘é¡¹ç›®ä»¥ä½¿ä¿®å¤ç”Ÿæ•ˆã€‚

## ğŸ”¬ éªŒè¯æ–¹æ³•

ä¿®å¤åçš„æ—¥å¿—åº”è¯¥æ˜¾ç¤ºï¼š
```
åœ¨å±€Claude Code[é¡µé¢æ¢å¤ç­–ç•¥]+é¡µé¢çŠ¶æ€æ£€æŸ¥ç»“æœ: {æ­£å¸¸çš„JSONç»“æœ}
åœ¨å±€Claude Code[é¡µé¢æ¢å¤ç­–ç•¥]+ç­–ç•¥0æ‰§è¡Œç»“æœ: content_made_visible_1_containers
åœ¨å±€Claude Code[é¡µé¢æ¢å¤ç­–ç•¥]+ç­–ç•¥1æ‰§è¡Œç»“æœ: reloadOtherPages_called
åœ¨å±€Claude Code[é¡µé¢æ¢å¤ç­–ç•¥]+ç­–ç•¥2æ‰§è¡Œç»“æœ: events_fired
åœ¨å±€Claude Code[é¡µé¢æ¢å¤ç­–ç•¥]+ç­–ç•¥3æ‰§è¡Œç»“æœ: scroll_triggered
```

è€Œä¸æ˜¯JavaScriptå¼‚å¸¸é”™è¯¯ã€‚