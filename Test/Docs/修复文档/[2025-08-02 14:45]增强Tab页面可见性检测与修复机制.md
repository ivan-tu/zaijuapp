# 增强Tab页面可见性检测与修复机制

## 问题描述
手势返回到Tab页面时，页面内容不显示（空白），但WebView状态显示正常。需要通过切换其他Tab才能重新显示内容。

## 问题分析
1. WebView报告状态正常（isExist=YES, isLoading=YES）
2. 但页面在视觉上显示为空白
3. JavaScript桥接和状态管理正常，问题在于页面内容的实际渲染

## 解决方案

### 添加页面可见性检测机制
在 `XZWKWebViewBaseController.m` 中添加了完整的页面可见性检测与修复系统：

#### 1. checkAndFixPageVisibility 方法（第5121行）
- 通过JavaScript检查页面真实的视觉状态
- 检测document.body的display、visibility、opacity属性
- 统计可见元素数量
- 判断页面是否需要修复

#### 2. performPageVisibilityFix 方法（第5226行）
执行多层次的页面修复：
- 强制显示document.body
- 修复被隐藏的主要容器元素
- 移除可能的loading遮罩
- 修复内容元素的显示状态
- 触发强制重新渲染
- 触发布局相关事件

#### 3. verifyPageVisibilityAfterFix 方法（第5327行）
- 修复完成后验证页面状态
- 确认修复是否成功
- 记录修复结果

#### 4. considerPageReload 方法（第5394行）
- 当修复失败时的备用方案
- 重新加载页面内容
- 防频繁重载保护机制

### 触发时机
在pageShow事件后，对Tab页面延迟0.5秒执行可见性检查：
```objc
// 在局Claude Code[Tab空白修复]+pageShow后检查页面是否真的显示
if (self.isTabbarShow) {
    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(0.5 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{
        [self checkAndFixPageVisibility];
    });
}
```

## 修复机制的特点

### 智能检测
- 检查CSS样式的实际计算值
- 统计真正可见的元素数量
- 区分结构存在和视觉可见

### 渐进式修复
1. 基础状态修复（display、visibility、opacity）
2. 容器元素修复
3. 内容元素修复
4. 强制重新渲染
5. 事件触发

### 安全机制
- try-catch异常处理
- 防重复执行保护
- 时间间隔控制
- 状态验证

## 预期效果
1. 自动检测手势返回后的Tab页面显示问题
2. 智能修复CSS可见性问题
3. 必要时重新加载页面内容
4. 提供详细的日志记录便于调试

## 调试日志
所有相关操作都有详细的日志输出，关键字：`[页面可见性修复]`

## 测试建议
1. 测试手势返回到不同Tab页面的显示效果
2. 验证修复机制是否正常工作
3. 检查日志输出确认修复流程
4. 测试修复失败时的重新加载机制