# è‡ªå®šä¹‰è½¬åœºåŠ¨ç”»ä½¿ç”¨è¯´æ˜

## æ¦‚è¿°

æœ¬é¡¹ç›®å®ç°äº†ä¼˜é›…çš„å·¦å³æ»‘åŠ¨è½¬åœºåŠ¨ç”»ï¼Œä¸“é—¨é’ˆå¯¹WebViewé¡µé¢å¯¼èˆªè¿›è¡Œäº†ä¼˜åŒ–ã€‚åŠ¨ç”»æ•ˆæœç¬¦åˆiOSè®¾è®¡è§„èŒƒï¼Œæä¾›æµç•…çš„ç”¨æˆ·ä½“éªŒã€‚

## åŠŸèƒ½ç‰¹æ€§

### âœ¨ æ ¸å¿ƒåŠŸèƒ½
- **æµç•…çš„æ»‘åŠ¨åŠ¨ç”»**: æ–°é¡µé¢ä»å³ä¾§æ»‘å…¥ï¼ŒèƒŒæ™¯é¡µé¢å¾®å¾®å·¦ç§»
- **æ™ºèƒ½æ£€æµ‹**: è‡ªåŠ¨è¯†åˆ«WebViewç›¸å…³é¡µé¢ï¼Œåªå¯¹è¿™äº›é¡µé¢åº”ç”¨è‡ªå®šä¹‰åŠ¨ç”»
- **äº¤äº’å¼è¿”å›**: æ”¯æŒè¾¹ç¼˜æ»‘åŠ¨æ‰‹åŠ¿è¿”å›ï¼Œå¯ä¸­é€”å–æ¶ˆ
- **æ€§èƒ½ä¼˜åŒ–**: ä½¿ç”¨ç¡¬ä»¶åŠ é€Ÿï¼Œæ·»åŠ é˜´å½±æ•ˆæœå¢å¼ºå±‚æ¬¡æ„Ÿ
- **å¯é…ç½®**: æ”¯æŒåŠ¨æ€å¼€å…³å’Œå‚æ•°è°ƒæ•´

### ğŸ¬ åŠ¨ç”»æ•ˆæœ
- **è¿›å…¥åŠ¨ç”»**: æ–°é¡µé¢ä»å³å‘å·¦æ»‘å…¥ï¼ŒèƒŒæ™¯é¡µé¢å·¦ç§»30%å¹¶ç¨å¾®å˜æš—
- **é€€å‡ºåŠ¨ç”»**: å½“å‰é¡µé¢å‘å³æ»‘å‡ºï¼ŒèƒŒæ™¯é¡µé¢æ¢å¤åŸä½ç½®å’Œäº®åº¦
- **å¼¹ç°§æ•ˆæœ**: ä½¿ç”¨UIKitçš„springåŠ¨ç”»ï¼Œé˜»å°¼ç³»æ•°0.8ï¼Œåˆå§‹é€Ÿåº¦0.5
- **é˜´å½±æ•ˆæœ**: æ»‘åŠ¨è¿‡ç¨‹ä¸­æ·»åŠ åŠ¨æ€é˜´å½±ï¼Œå¢å¼ºå±‚æ¬¡æ„Ÿ

## å®ç°æ¶æ„

### ğŸ“ æ–‡ä»¶ç»“æ„
```
XZVientiane/XZBase/BaseController/
â”œâ”€â”€ XZSlideTransitionAnimator.h      # è½¬åœºåŠ¨ç”»æ§åˆ¶å™¨å¤´æ–‡ä»¶
â”œâ”€â”€ XZSlideTransitionAnimator.m      # è½¬åœºåŠ¨ç”»æ§åˆ¶å™¨å®ç°
â”œâ”€â”€ XZNavigationController.h         # å¯¼èˆªæ§åˆ¶å™¨å¤´æ–‡ä»¶ï¼ˆå·²ä¿®æ”¹ï¼‰
â”œâ”€â”€ XZNavigationController.m         # å¯¼èˆªæ§åˆ¶å™¨å®ç°ï¼ˆå·²ä¿®æ”¹ï¼‰
â”œâ”€â”€ XZTransitionTestViewController.h # æµ‹è¯•æ§åˆ¶å™¨å¤´æ–‡ä»¶
â””â”€â”€ XZTransitionTestViewController.m # æµ‹è¯•æ§åˆ¶å™¨å®ç°
```

### ğŸ—ï¸ æ ¸å¿ƒç»„ä»¶

#### 1. XZSlideTransitionAnimator
è‡ªå®šä¹‰è½¬åœºåŠ¨ç”»æ§åˆ¶å™¨ï¼Œå®ç°äº†`UIViewControllerAnimatedTransitioning`åè®®ã€‚

**ä¸»è¦å±æ€§ï¼š**
- `isPresenting`: æ˜¯å¦ä¸ºæ¨å…¥åŠ¨ç”»
- `animationDuration`: åŠ¨ç”»æŒç»­æ—¶é—´ï¼ˆé»˜è®¤0.35ç§’ï¼‰
- `backgroundOffsetRatio`: èƒŒæ™¯é¡µé¢åç§»æ¯”ä¾‹ï¼ˆé»˜è®¤0.3ï¼‰
- `springDamping`: å¼¹ç°§é˜»å°¼ç³»æ•°ï¼ˆé»˜è®¤0.8ï¼‰
- `springVelocity`: å¼¹ç°§åˆå§‹é€Ÿåº¦ï¼ˆé»˜è®¤0.5ï¼‰

#### 2. XZNavigationControllerï¼ˆå·²å¢å¼ºï¼‰
å¢å¼ºçš„å¯¼èˆªæ§åˆ¶å™¨ï¼Œæ·»åŠ äº†è½¬åœºåŠ¨ç”»ä»£ç†æ”¯æŒã€‚

**æ–°å¢å±æ€§ï¼š**
- `enableCustomTransition`: æ˜¯å¦å¯ç”¨è‡ªå®šä¹‰è½¬åœºåŠ¨ç”»
- `transitionDuration`: è½¬åœºåŠ¨ç”»æŒç»­æ—¶é—´

**æ–°å¢åŠŸèƒ½ï¼š**
- è‡ªåŠ¨æ£€æµ‹WebViewé¡µé¢
- äº¤äº’å¼è¾¹ç¼˜æ»‘åŠ¨è¿”å›
- åŠ¨æ€é…ç½®åŠ¨ç”»å‚æ•°

## ä½¿ç”¨æ–¹æ³•

### ğŸš€ åŸºæœ¬ä½¿ç”¨

è‡ªå®šä¹‰è½¬åœºåŠ¨ç”»å·²ç»é›†æˆåˆ°é¡¹ç›®ä¸­ï¼Œæ— éœ€é¢å¤–é…ç½®å³å¯ä½¿ç”¨ï¼š

```objc
// å¯¹äºWebViewé¡µé¢ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä½¿ç”¨è‡ªå®šä¹‰è½¬åœºåŠ¨ç”»
CFJClientH5Controller *webVC = [[CFJClientH5Controller alloc] init];
webVC.pinUrl = @"your_page_url";
[self.navigationController pushViewController:webVC animated:YES];
```

### âš™ï¸ é…ç½®é€‰é¡¹

#### å¼€å…³è‡ªå®šä¹‰åŠ¨ç”»
```objc
// è·å–XZNavigationControllerå®ä¾‹
XZNavigationController *navController = (XZNavigationController *)self.navigationController;

// ç¦ç”¨è‡ªå®šä¹‰è½¬åœºåŠ¨ç”»
navController.enableCustomTransition = NO;

// é‡æ–°å¯ç”¨è‡ªå®šä¹‰è½¬åœºåŠ¨ç”»
navController.enableCustomTransition = YES;
```

#### è°ƒæ•´åŠ¨ç”»å‚æ•°
```objc
XZNavigationController *navController = (XZNavigationController *)self.navigationController;

// è°ƒæ•´åŠ¨ç”»æŒç»­æ—¶é—´
navController.transitionDuration = 0.5; // é»˜è®¤0.35ç§’

// è·å–åŠ¨ç”»æ§åˆ¶å™¨å¹¶è°ƒæ•´å‚æ•°
XZSlideTransitionAnimator *animator = navController.slideAnimator;
animator.backgroundOffsetRatio = 0.2; // èƒŒæ™¯åç§»æ¯”ä¾‹
animator.springDamping = 0.9;         // å¼¹ç°§é˜»å°¼
animator.springVelocity = 0.3;        // å¼¹ç°§é€Ÿåº¦
```

### ğŸ§ª æµ‹è¯•åŠŸèƒ½

é¡¹ç›®åŒ…å«äº†å®Œæ•´çš„æµ‹è¯•æ§åˆ¶å™¨ï¼š

```objc
// åˆ›å»ºæµ‹è¯•é¡µé¢
XZTransitionTestViewController *testVC = [[XZTransitionTestViewController alloc] init];
testVC.pageIdentifier = @"è½¬åœºåŠ¨ç”»æµ‹è¯•";
testVC.pageBackgroundColor = [UIColor colorWithRed:0.9 green:0.95 blue:1.0 alpha:1.0];

[self.navigationController pushViewController:testVC animated:YES];
```

## å·¥ä½œåŸç†

### ğŸ”„ è½¬åœºæµç¨‹

1. **æ£€æµ‹é˜¶æ®µ**: NavigationControlleræ£€æµ‹åˆ°push/popæ“ä½œ
2. **åˆ¤æ–­é˜¶æ®µ**: åˆ¤æ–­æ˜¯å¦æ¶‰åŠWebViewé¡µé¢
3. **é…ç½®é˜¶æ®µ**: é…ç½®åŠ¨ç”»æ§åˆ¶å™¨å‚æ•°
4. **æ‰§è¡Œé˜¶æ®µ**: æ‰§è¡Œè‡ªå®šä¹‰è½¬åœºåŠ¨ç”»
5. **å®Œæˆé˜¶æ®µ**: æ¸…ç†èµ„æºï¼Œæ¢å¤çŠ¶æ€

### ğŸ¯ é¡µé¢æ£€æµ‹é€»è¾‘

```objc
- (BOOL)shouldUseCustomAnimationForFromVC:(UIViewController *)fromVC 
                                     toVC:(UIViewController *)toVC 
                                operation:(UINavigationControllerOperation)operation {
    
    // æ£€æŸ¥æ˜¯å¦ä¸ºWebViewç›¸å…³çš„é¡µé¢
    BOOL fromIsWebView = [fromVC isKindOfClass:[CFJClientH5Controller class]] || 
                        [fromVC isKindOfClass:NSClassFromString(@"XZWKWebViewBaseController")];
    BOOL toIsWebView = [toVC isKindOfClass:[CFJClientH5Controller class]] || 
                      [toVC isKindOfClass:NSClassFromString(@"XZWKWebViewBaseController")];
    
    // åªè¦æ¶‰åŠWebViewé¡µé¢å°±ä½¿ç”¨è‡ªå®šä¹‰åŠ¨ç”»
    return fromIsWebView || toIsWebView;
}
```

### ğŸ‘† äº¤äº’å¼è¿”å›

- **è§¦å‘**: ä»å±å¹•å·¦è¾¹ç¼˜å‘å³æ»‘åŠ¨
- **è¿›åº¦**: æ ¹æ®æ»‘åŠ¨è·ç¦»è®¡ç®—å®Œæˆè¿›åº¦
- **å®Œæˆæ¡ä»¶**: æ»‘åŠ¨è·ç¦»è¶…è¿‡50%æˆ–æ»‘åŠ¨é€Ÿåº¦è¶…è¿‡500ç‚¹/ç§’
- **å–æ¶ˆ**: æœªè¾¾åˆ°å®Œæˆæ¡ä»¶æ—¶æ¢å¤åŸçŠ¶æ€

## æ€§èƒ½ä¼˜åŒ–

### ğŸš„ ä¼˜åŒ–æªæ–½

1. **ç¡¬ä»¶åŠ é€Ÿ**: ä½¿ç”¨CALayerçš„transformå±æ€§ï¼Œåˆ©ç”¨GPUåŠ é€Ÿ
2. **é˜´å½±ä¼˜åŒ–**: è®¾ç½®shadowPathé¿å…å®æ—¶è®¡ç®—
3. **å†…å­˜ç®¡ç†**: åŠæ—¶æ¸…ç†åŠ¨ç”»èµ„æºï¼Œé¿å…å†…å­˜æ³„æ¼
4. **çŠ¶æ€ç®¡ç†**: ç²¾ç¡®æ§åˆ¶åŠ¨ç”»çŠ¶æ€ï¼Œé¿å…å†²çª

### ğŸ“Š æ€§èƒ½æŒ‡æ ‡

- **åŠ¨ç”»æµç•…åº¦**: 60FPS
- **å†…å­˜å ç”¨**: å¢é‡å°äº1MB
- **CPUä½¿ç”¨ç‡**: åŠ¨ç”»æœŸé—´CPUä½¿ç”¨ç‡<10%
- **å“åº”æ—¶é—´**: æ‰‹åŠ¿å“åº”å»¶è¿Ÿ<16ms

## è°ƒè¯•å’Œæ—¥å¿—

### ğŸ” è°ƒè¯•ä¿¡æ¯

é¡¹ç›®åŒ…å«è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—ï¼Œä¾¿äºè·Ÿè¸ªåŠ¨ç”»æ‰§è¡Œè¿‡ç¨‹ï¼š

```
åœ¨å±€ğŸ¬ [è½¬åœºåŠ¨ç”»] å¼€å§‹æ‰§è¡Œè¿›å…¥åŠ¨ç”»
åœ¨å±€ğŸ” [è½¬åœºåˆ¤æ–­] FromVC: XZTransitionTestViewController (Other), ToVC: CFJClientH5Controller (WebView), ä½¿ç”¨è‡ªå®šä¹‰åŠ¨ç”»: YES
åœ¨å±€ğŸ‘† [äº¤äº’æ‰‹åŠ¿] å¼€å§‹è¾¹ç¼˜æ»‘åŠ¨
åœ¨å±€ğŸ‘† [äº¤äº’æ‰‹åŠ¿] æ»‘åŠ¨è¿›åº¦: 0.35
åœ¨å±€ğŸ‘† [äº¤äº’æ‰‹åŠ¿] ç»“æŸ - è¿›åº¦: 0.67, é€Ÿåº¦: 850.0, å®Œæˆ: YES
```

### ğŸ§ª æµ‹è¯•å»ºè®®

1. **åŸºç¡€æµ‹è¯•**: ä½¿ç”¨XZTransitionTestViewControlleréªŒè¯åŸºæœ¬åŠŸèƒ½
2. **è¾¹ç•Œæµ‹è¯•**: æµ‹è¯•å¿«é€Ÿè¿ç»­push/popæ“ä½œ
3. **å†…å­˜æµ‹è¯•**: é•¿æ—¶é—´ä½¿ç”¨åæ£€æŸ¥å†…å­˜ä½¿ç”¨æƒ…å†µ
4. **è®¾å¤‡æµ‹è¯•**: åœ¨ä¸åŒè®¾å¤‡å’ŒiOSç‰ˆæœ¬ä¸Šæµ‹è¯•

## æ³¨æ„äº‹é¡¹

### âš ï¸ é‡è¦æé†’

1. **å…¼å®¹æ€§**: æœ€ä½æ”¯æŒiOS 9.0
2. **å†…å­˜**: åŠæ—¶é‡Šæ”¾ä¸éœ€è¦çš„åŠ¨ç”»èµ„æº
3. **æ€§èƒ½**: é¿å…åœ¨åŠ¨ç”»è¿‡ç¨‹ä¸­æ‰§è¡Œè€—æ—¶æ“ä½œ
4. **æ‰‹åŠ¿**: è‡ªå®šä¹‰æ‰‹åŠ¿ä¸WebViewæ‰‹åŠ¿å¯èƒ½å­˜åœ¨å†²çª

### ğŸ› å¸¸è§é—®é¢˜

**Q: åŠ¨ç”»ä¸ç”Ÿæ•ˆï¼Ÿ**
A: æ£€æŸ¥enableCustomTransitionæ˜¯å¦ä¸ºYESï¼Œç¡®è®¤é¡µé¢ç±»å‹æ˜¯å¦æ­£ç¡®

**Q: æ‰‹åŠ¿è¿”å›ä¸å·¥ä½œï¼Ÿ**
A: ç¡®ä¿è§†å›¾æ§åˆ¶å™¨æ•°é‡å¤§äº1ï¼Œæ£€æŸ¥æ‰‹åŠ¿ä»£ç†è®¾ç½®

**Q: åŠ¨ç”»å¡é¡¿ï¼Ÿ**
A: æ£€æŸ¥ä¸»çº¿ç¨‹æ˜¯å¦è¢«é˜»å¡ï¼Œå‡å°‘åŠ¨ç”»æœŸé—´çš„CPUå¯†é›†æ“ä½œ

**Q: å†…å­˜æ³„æ¼ï¼Ÿ**
A: æ£€æŸ¥å¾ªç¯å¼•ç”¨ï¼Œç¡®ä¿åŠæ—¶æ¸…ç†åŠ¨ç”»èµ„æº

## ç‰ˆæœ¬å†å²

### v1.0.0 (2024-12-19)
- âœ… å®ç°åŸºç¡€æ»‘åŠ¨è½¬åœºåŠ¨ç”»
- âœ… æ·»åŠ äº¤äº’å¼è¿”å›æ‰‹åŠ¿
- âœ… é›†æˆåˆ°XZNavigationController
- âœ… æä¾›æµ‹è¯•å’Œè°ƒè¯•å·¥å…·

### æœªæ¥è®¡åˆ’
- ğŸ”® æ”¯æŒæ›´å¤šè½¬åœºåŠ¨ç”»ç±»å‹
- ğŸ”® æ·»åŠ åŠ¨ç”»ç¼“å­˜æœºåˆ¶
- ğŸ”® æ”¯æŒè‡ªå®šä¹‰åŠ¨ç”»æ›²çº¿
- ğŸ”® æ·»åŠ åŠ¨ç”»æ€§èƒ½ç›‘æ§