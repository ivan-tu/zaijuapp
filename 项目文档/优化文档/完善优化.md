ğŸ” ä¼˜åŒ–è®¡åˆ’ï¼šæ™ºèƒ½é€‰æ‹©æœ€ä½³å®ç°                             â”‚ â”‚
â”‚ â”‚                                                           â”‚ â”‚
â”‚ â”‚ ğŸ“Š å®ç°è´¨é‡å¯¹æ¯”åˆ†æ                                       â”‚ â”‚
â”‚ â”‚                                                           â”‚ â”‚
â”‚ â”‚ 1. handleAreaSelect åœ°åŒºé€‰æ‹©                              â”‚ â”‚
â”‚ â”‚                                                           â”‚ â”‚
â”‚ â”‚ CFJClientH5Controllerç‰ˆæœ¬ï¼š                               â”‚ â”‚
â”‚ â”‚                                                           â”‚ â”‚
â”‚ â”‚ - âœ… ä¼˜åŠ¿ï¼šä½¿ç”¨JFCityViewControllerï¼Œæä¾›å®Œæ•´åŸå¸‚åˆ—è¡¨UI    â”‚ â”‚
â”‚ â”‚ - âœ… ä¼˜åŠ¿ï¼šæ”¯æŒåŸå¸‚ä»£ç å›è°ƒï¼Œæ•°æ®æ›´å®Œæ•´                    â”‚ â”‚
â”‚ â”‚ - âœ… ä¼˜åŠ¿ï¼šä¿å­˜é€‰æ‹©åˆ°æœ¬åœ°å­˜å‚¨ï¼Œæ”¯æŒå‘é€é€šçŸ¥                â”‚ â”‚
â”‚ â”‚ - âŒ åŠ£åŠ¿ï¼šä¾èµ–ç‰¹å®šUIæ§åˆ¶å™¨ï¼Œè€¦åˆåº¦é«˜                      â”‚ â”‚
â”‚ â”‚                                                           â”‚ â”‚
â”‚ â”‚ JSUIHandlerç‰ˆæœ¬ï¼š                                         â”‚ â”‚
â”‚ â”‚                                                           â”‚ â”‚
â”‚ â”‚ - âŒ åŠ£åŠ¿ï¼šä½¿ç”¨MOFSPickerManagerï¼Œå¯èƒ½åªæ˜¯ç®€å•é€‰æ‹©å™¨       â”‚ â”‚
â”‚ â”‚ - âŒ åŠ£åŠ¿ï¼šæ•°æ®æ ¼å¼ä¸ä¸€è‡´ï¼ˆcode/value vs                   â”‚ â”‚
â”‚ â”‚ cityTitle/cityCodeï¼‰                                      â”‚ â”‚
â”‚ â”‚ - âœ… ä¼˜åŠ¿ï¼šä»£ç æ›´ç®€æ´ï¼Œä½¿ç”¨blockå›è°ƒ                       â”‚ â”‚
â”‚ â”‚                                                           â”‚ â”‚
â”‚ â”‚ æ¨èï¼šä¿ç•™CFJClientH5Controllerç‰ˆæœ¬ï¼Œä½†éœ€è¦ç»Ÿä¸€å›è°ƒæ ¼å¼   â”‚ â”‚
â”‚ â”‚                                                           â”‚ â”‚
â”‚ â”‚ 2. handleGetLocation å®šä½åŠŸèƒ½                             â”‚ â”‚
â”‚ â”‚                                                           â”‚ â”‚
â”‚ â”‚ JSLocationHandlerç‰ˆæœ¬ï¼š                                   â”‚ â”‚
â”‚ â”‚                                                           â”‚ â”‚
â”‚ â”‚ - âœ… ä¼˜åŠ¿ï¼šå®Œå–„çš„æƒé™è¯·æ±‚å¤„ç†ï¼ˆ30ç§’è¶…æ—¶ï¼‰                  â”‚ â”‚
â”‚ â”‚ - âœ… ä¼˜åŠ¿ï¼šè¯¦ç»†çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—                            â”‚ â”‚
â”‚ â”‚ - âœ… ä¼˜åŠ¿ï¼šæ”¯æŒç¼“å­˜å®šä½ä¿¡æ¯                                â”‚ â”‚
â”‚ â”‚ - âœ… ä¼˜åŠ¿ï¼šä½¿ç”¨CLLocationManagerDelegateæ­£ç¡®å¤„ç†æƒé™å˜åŒ–   â”‚ â”‚
â”‚ â”‚                                                           â”‚ â”‚
â”‚ â”‚ CFJClientH5Controllerç‰ˆæœ¬ï¼š                               â”‚ â”‚
â”‚ â”‚                                                           â”‚ â”‚
â”‚ â”‚ - âŒ åŠ£åŠ¿ï¼šæƒé™å¤„ç†å¯èƒ½ä¸å¤Ÿå®Œå–„                            â”‚ â”‚
â”‚ â”‚ - âŒ åŠ£åŠ¿ï¼šé”™è¯¯ä¿¡æ¯ä¸å¤Ÿè¯¦ç»†                                â”‚ â”‚
â”‚ â”‚                                                           â”‚ â”‚
â”‚ â”‚ æ¨èï¼šä¿ç•™JSLocationHandlerç‰ˆæœ¬                           â”‚ â”‚
â”‚ â”‚                                                           â”‚ â”‚
â”‚ â”‚ 3. handleShowToast æ¶ˆæ¯æç¤º                               â”‚ â”‚
â”‚ â”‚                                                           â”‚ â”‚
â”‚ â”‚ CFJClientH5Controllerç‰ˆæœ¬ï¼š                               â”‚ â”‚
â”‚ â”‚                                                           â”‚ â”‚
â”‚ â”‚ - âœ… ä¼˜åŠ¿ï¼šæ”¯æŒsuccess/error/loadingå›¾æ ‡                   â”‚ â”‚
â”‚ â”‚ - âœ…                                                       â”‚ â”‚
â”‚ â”‚ ä¼˜åŠ¿ï¼šè‡ªå®šä¹‰å›¾æ ‡ç»˜åˆ¶ï¼ˆcreateSuccessIcon/createErrorIconï¼‰ â”‚ â”‚
â”‚ â”‚ - âœ… ä¼˜åŠ¿ï¼šå¤„ç†loadingçŠ¶æ€çš„è‡ªåŠ¨å…³é—­                       â”‚ â”‚
â”‚ â”‚                                                           â”‚ â”‚
â”‚ â”‚ æ¨èï¼šä¿ç•™CFJClientH5Controllerç‰ˆæœ¬                       â”‚ â”‚
â”‚ â”‚                                                           â”‚ â”‚
â”‚ â”‚ ğŸ¯ ä¼˜åŒ–æ‰§è¡Œç­–ç•¥                                           â”‚ â”‚
â”‚ â”‚                                                           â”‚ â”‚
â”‚ â”‚ ç¬¬ä¸€é˜¶æ®µï¼šä»£ç è´¨é‡è¯„ä¼°ï¼ˆ1-2å°æ—¶ï¼‰                         â”‚ â”‚
â”‚ â”‚                                                           â”‚ â”‚
â”‚ â”‚ 1. é€ä¸€æ¯”è¾ƒæ¯ä¸ªé‡å¤æ–¹æ³•ï¼š                                 â”‚ â”‚
â”‚ â”‚   - åŠŸèƒ½å®Œæ•´æ€§                                            â”‚ â”‚
â”‚ â”‚   - é”™è¯¯å¤„ç†è´¨é‡                                          â”‚ â”‚
â”‚ â”‚   - å›è°ƒæ•°æ®æ ¼å¼                                          â”‚ â”‚
â”‚ â”‚   - ä»£ç å¯ç»´æŠ¤æ€§                                          â”‚ â”‚
â”‚ â”‚ 2. åˆ›å»ºå®ç°é€‰æ‹©è¡¨ï¼š                                       â”‚ â”‚
â”‚ â”‚ | æ–¹æ³•å | ä¿ç•™ç‰ˆæœ¬ | ç†ç”± |                              â”‚ â”‚
â”‚ â”‚ |--------|---------|------|                               â”‚ â”‚
â”‚ â”‚ | handleAreaSelect | CFJClientH5Controller |              â”‚ â”‚
â”‚ â”‚ åŠŸèƒ½æ›´å®Œæ•´ï¼Œæ”¯æŒåŸå¸‚åˆ—è¡¨UI |                              â”‚ â”‚
â”‚ â”‚ | handleGetLocation | JSLocationHandler | æƒé™å¤„ç†æ›´å®Œå–„  â”‚ â”‚
â”‚ â”‚ |                                                         â”‚ â”‚
â”‚ â”‚ | handleShowToast | CFJClientH5Controller | å›¾æ ‡æ”¯æŒæ›´å¥½  â”‚ â”‚
â”‚ â”‚ |                                                         â”‚ â”‚
â”‚ â”‚ | ... | ... | ... |                                       â”‚ â”‚
â”‚ â”‚                                                           â”‚ â”‚
â”‚ â”‚ ç¬¬äºŒé˜¶æ®µï¼šæ™ºèƒ½åˆå¹¶ï¼ˆ2-3å°æ—¶ï¼‰                             â”‚ â”‚
â”‚ â”‚                                                           â”‚ â”‚
â”‚ â”‚ 1. ä¿ç•™æœ€ä½³å®ç°ï¼š                                         â”‚ â”‚
â”‚ â”‚   - åˆ é™¤è´¨é‡è¾ƒå·®çš„ç‰ˆæœ¬                                    â”‚ â”‚
â”‚ â”‚   - ç»Ÿä¸€å›è°ƒæ ¼å¼ä¸ºformatCallbackResponse                  â”‚ â”‚
â”‚ â”‚   - ç¡®ä¿æ•°æ®æ ¼å¼å…¼å®¹                                      â”‚ â”‚
â”‚ â”‚ 2. å¤„ç†ä¾èµ–å…³ç³»ï¼š                                         â”‚ â”‚
â”‚ â”‚   -                                                       â”‚ â”‚
â”‚ â”‚ å¦‚æœCFJClientH5Controllerç‰ˆæœ¬æ›´å¥½ï¼Œå°†å…¶æ”¹é€ ä¸ºHandleræ¨¡å¼  â”‚ â”‚
â”‚ â”‚   -                                                       â”‚ â”‚
â”‚ â”‚ å¦‚æœJSHandlerç‰ˆæœ¬æ›´å¥½ï¼Œåˆ é™¤CFJClientH5Controllerä¸­çš„å®ç°  â”‚ â”‚
â”‚ â”‚                                                           â”‚ â”‚
â”‚ â”‚ ç¬¬ä¸‰é˜¶æ®µï¼šæ¶æ„ä¼˜åŒ–ï¼ˆ1-2å°æ—¶ï¼‰                             â”‚ â”‚
â”‚ â”‚                                                           â”‚ â”‚
â”‚ â”‚ 1. é‡æ„jsCallObjcï¼š                                       â”‚ â”‚
â”‚ â”‚ - (void)jsCallObjc:(NSDictionary *)data                   â”‚ â”‚
â”‚ â”‚ completion:(XZWebViewJSCallbackBlock)completion {         â”‚ â”‚
â”‚ â”‚     NSString *action = data[@"action"];                   â”‚ â”‚
â”‚ â”‚                                                           â”‚ â”‚
â”‚ â”‚     // ç‰¹æ®Šå¤„ç†ï¼šæŸäº›actionä¿ç•™åœ¨CFJClientH5Controllerä¸­  â”‚ â”‚
â”‚ â”‚     if ([self shouldHandleInternally:action]) {           â”‚ â”‚
â”‚ â”‚         [self handleInternalAction:action data:data       â”‚ â”‚
â”‚ â”‚ completion:completion];                                   â”‚ â”‚
â”‚ â”‚         return;                                           â”‚ â”‚
â”‚ â”‚     }                                                     â”‚ â”‚
â”‚ â”‚                                                           â”‚ â”‚
â”‚ â”‚     // å…¶ä»–actionäº¤ç»™JSActionHandlerManagerå¤„ç†           â”‚ â”‚
â”‚ â”‚     [[JSActionHandlerManager sharedManager]               â”‚ â”‚
â”‚ â”‚ handleJavaScriptCall:data                                 â”‚ â”‚
â”‚ â”‚                                                           â”‚ â”‚
â”‚ â”‚ controller:self                                           â”‚ â”‚
â”‚ â”‚                                                           â”‚ â”‚
â”‚ â”‚ completion:completion];                                   â”‚ â”‚
â”‚ â”‚ }                                                         â”‚ â”‚
â”‚ â”‚                                                           â”‚ â”‚
â”‚ â”‚ ç¬¬å››é˜¶æ®µï¼šæ¸…ç†å’ŒéªŒè¯ï¼ˆ1å°æ—¶ï¼‰                             â”‚ â”‚
â”‚ â”‚                                                           â”‚ â”‚
â”‚ â”‚ 1. ä»£ç æ¸…ç†ï¼š                                             â”‚ â”‚
â”‚ â”‚   - åˆ é™¤é‡å¤import                                        â”‚ â”‚
â”‚ â”‚   - å‡å°‘è°ƒè¯•æ—¥å¿—                                          â”‚ â”‚
â”‚ â”‚   - åˆ é™¤æœªä½¿ç”¨ä»£ç                                         â”‚ â”‚
â”‚ â”‚ 2. åŠŸèƒ½éªŒè¯ï¼š                                             â”‚ â”‚
â”‚ â”‚   - æµ‹è¯•æ¯ä¸ªåŠŸèƒ½                                          â”‚ â”‚
â”‚ â”‚   - ç¡®ä¿å›è°ƒæ ¼å¼æ­£ç¡®                                      â”‚ â”‚
â”‚ â”‚   - éªŒè¯æ•°æ®å…¼å®¹æ€§                                        â”‚ â”‚
â”‚ â”‚                                                           â”‚ â”‚
â”‚ â”‚ âš ï¸ å…³é”®å†³ç­–ç‚¹                                             â”‚ â”‚
â”‚ â”‚                                                           â”‚ â”‚
â”‚ â”‚ 1. å›è°ƒæ ¼å¼ç»Ÿä¸€ï¼š                                         â”‚ â”‚
â”‚ â”‚   - areaSelectéœ€è¦ç»Ÿä¸€ä¸ºï¼šcityTitle/cityCode æˆ–           â”‚ â”‚
â”‚ â”‚ code/value                                                â”‚ â”‚
â”‚ â”‚   - å»ºè®®ä½¿ç”¨cityTitle/cityCodeï¼ˆæ›´è¯­ä¹‰åŒ–ï¼‰                â”‚ â”‚
â”‚ â”‚ 2. ä¾èµ–ç®¡ç†ï¼š                                             â”‚ â”‚
â”‚ â”‚   - JFCityViewControllerï¼ˆåŸå¸‚é€‰æ‹©UIï¼‰åº”è¯¥ä¿ç•™            â”‚ â”‚
â”‚ â”‚   - MOFSPickerManagerå¯èƒ½éœ€è¦è¯„ä¼°æ˜¯å¦è¿˜éœ€è¦               â”‚ â”‚
â”‚ â”‚ 3. é”™è¯¯å¤„ç†ï¼š                                             â”‚ â”‚
â”‚ â”‚   - ç»Ÿä¸€ä½¿ç”¨formatCallbackResponse                        â”‚ â”‚
â”‚ â”‚   - ç¡®ä¿successå­—æ®µä¸ºå­—ç¬¦ä¸²"true"/"false"                 â”‚ â”‚
â”‚ â”‚                                                           â”‚ â”‚
â”‚ â”‚ ğŸ“ˆ é¢„æœŸæ•ˆæœ                                               â”‚ â”‚
â”‚ â”‚                                                           â”‚ â”‚
â”‚ â”‚ - ä»£ç è¡Œæ•°ï¼šå‡å°‘30-40%ï¼ˆåˆ é™¤é‡å¤å®ç°ï¼‰                    â”‚ â”‚
â”‚ â”‚ - ç»´æŠ¤æ€§ï¼šå¤§å¹…æå‡ï¼ˆå•ä¸€èŒè´£ï¼‰                            â”‚ â”‚
â”‚ â”‚ - è´¨é‡ï¼šä¿ç•™æ¯ä¸ªåŠŸèƒ½çš„æœ€ä½³å®ç°                            â”‚ â”‚
â”‚ â”‚ - å…¼å®¹æ€§ï¼šä¿æŒJavaScript APIä¸å˜                          â”‚ â”‚
â”‚ â”‚                                                           â”‚ â”‚
â”‚ â”‚ è¿™ä¸ªè®¡åˆ’ç¡®ä¿æˆ‘ä»¬ä¸æ˜¯ç›²ç›®åˆ é™¤ä»£ç ï¼Œè€Œæ˜¯æ™ºèƒ½åœ°é€‰æ‹©å’Œä¿ç•™æœ€  â”‚ â”‚
â”‚ â”‚ ä½³å®ç°ã€‚           



 1. JSActionHandlerManagerç°åœ¨ä¼šå¤„ç†ä¸€äº›åŸæœ¬åœ¨CFJClientH5Controllerä¸­çš„æ–¹æ³•
  2. éœ€è¦ä»childActionsä¸­ç§»é™¤å·²ç»ç”±JSBridgeå¤„ç†çš„actionï¼Œé¿å…é‡å¤å¤„ç†
  3. å¯ä»¥é€æ­¥åˆ é™¤CFJClientH5Controllerä¸­çš„é‡å¤å®ç°


   å·²ç»ç§»åˆ°JSBridgeä½†CFJClientH5Controllerä»åœ¨å¤„ç†çš„æ–¹æ³•ï¼š

  è¿™äº›æ–¹æ³•åœ¨childActionsåˆ—è¡¨ä¸­å·²è¢«ç§»é™¤ï¼Œç†è®ºä¸Šåº”è¯¥ç”±JSActionHandlerManagerå¤„ç†ï¼Œä½†å› ä¸ºJSActionH
  andlerManagerçš„importè¢«æ³¨é‡Šæ‰äº†ï¼Œå®é™…ä¸Šè¿™äº›æ–¹æ³•ç°åœ¨æ²¡æœ‰è¢«å¤„ç†ï¼š
  - showModal
  - showToast
  - showActionSheet
  - areaSelect
  - dateSelect
  - timeSelect
  - fancySelect
  - dateAndTimeSelect
  - stopPullDownRefresh

  2. ä»åœ¨CFJClientH5Controllerä¸­å¤„ç†çš„æ–¹æ³•ï¼š

  è¿™äº›åœ¨childActionsåˆ—è¡¨ä¸­ï¼Œç”±CFJClientH5Controllerç›´æ¥å¤„ç†ï¼š
  - request - ç½‘ç»œè¯·æ±‚
  - nativeGet - è·å–åŸç”Ÿæ•°æ®
  - hasWx - æ£€æŸ¥å¾®ä¿¡
  - isiPhoneX - è®¾å¤‡æ£€æµ‹
  - readMessage - æ¶ˆæ¯ç›¸å…³
  - setTabBarBadge/removeTabBarBadge/showTabBarRedDot/hideTabBarRedDot - TabBarç›¸å…³
  - navigateTo/navigateBack/reLaunch - å¯¼èˆªç›¸å…³
  - getLocation/showLocation/selectLocation/selectLocationCity - å®šä½ç›¸å…³
  - pageShow/pageHide/pageUnload - é¡µé¢ç”Ÿå‘½å‘¨æœŸ
  - copyLink/share/saveImage - åˆ†äº«ç›¸å…³
  - weixinLogin/weixinPay/aliPay - æ”¯ä»˜ç™»å½•ç›¸å…³
  - chooseFile/uploadFile/previewImage/QRScan - æ–‡ä»¶å’Œåª’ä½“ç›¸å…³
  - userLogin/userLogout - ç”¨æˆ·ç›¸å…³
  - switchTab - Tabåˆ‡æ¢
  - hideNavationbar/showNavationbar/setNavigationBarTitle - å¯¼èˆªæ æ§åˆ¶
  - closePresentWindow/changeMessageNum/noticemsg_setNumber/reloadOtherPages - å…¶ä»–åŠŸèƒ½

  3. å½“å‰é—®é¢˜ï¼š

  2. é‡å¤å®ç°ï¼šå¾ˆå¤šæ–¹æ³•åœ¨ä¸¤è¾¹éƒ½æœ‰å®ç°ï¼Œéœ€è¦å†³å®šä½¿ç”¨å“ªè¾¹çš„å®ç°ã€‚

  4. å»ºè®®ï¼š

  2. å¯ç”¨JSActionHandlerManageråï¼Œå¯ä»¥ç§»é™¤CFJClientH5Controllerä¸­çš„é‡å¤å®ç°
  3. ä¿æŒCFJClientH5Controlleråªå¤„ç†ä¸šåŠ¡ç‰¹å®šçš„æ–¹æ³•ï¼Œé€šç”¨çš„UIã€è®¾å¤‡ã€æ–‡ä»¶ç­‰æ“ä½œäº¤ç»™JSBridgeå¤„ç†